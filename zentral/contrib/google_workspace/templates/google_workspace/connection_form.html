{% extends 'base.html' %}
{% load base_extras %}
{% load ui_extras %}

{% block content %}
<ol class="breadcrumb">
  <li class="breadcrumb-item"><a href="/">Home</a></li>
  <li class="breadcrumb-item"><a href="{% url "google_workspace:index" %}">Google Workspace</a></li>
  <li class="breadcrumb-item"><a href="{% url "google_workspace:connections" %}">Connections</a></li>
  {% if object %}
  <li class="breadcrumb-item"><a href="{{ object.get_absolute_url }}">{{ object }}</a></li>
  <li class="breadcrumb-item active">Update</li>
  {% else %}
  <li class="breadcrumb-item active">Create</li>
  {% endif %}
</ol>

<h2>{% if object %}Update {{object}}{% else %}Create connection{% endif %}</h2>

<form class="update-form" method="POST" enctype="multipart/form-data">{% csrf_token %}

  {{Â form }}

  <p>
    {% if object %}
    <a href="{{ object.get_absolute_url }}" class="btn btn-outline-secondary">Cancel</a>
    {% else %}
    <a href="{% url 'google_workspace:connections' %}" class="btn btn-outline-secondary">Cancel</a>
    {% endif %}
    <button class="btn btn-primary">Save</button>
  </p>
</form>
{% endblock %}

{% block extrajs %}
<script nonce="{{ request.csp_nonce }}">
  function setEnabled(id, enabled) {
    const el = document.getElementById(id);
    if (!el) return;

    el.disabled = !enabled;
  }

  function toggleByType() {
    const typeEl = document.getElementById("id_type");
    if (!typeEl) return;

    const t = typeEl.value;

    const usesClientId = (t === "SA_CLOUD_ID");
    const usesFile     = (t === "OAUTH");

    setEnabled("id_customer_id", usesClientId);
    setEnabled("id_serialized_client_config", usesFile);

    if (usesClientId) {
      const f = document.getElementById("id_serialized_client_config");
      if (f) f.value = "";
    }
    if (usesFile) {
      const c = document.getElementById("id_customer_id");
      if (c) c.value = "";
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    const typeEl = document.getElementById("id_type");
    if (typeEl) typeEl.addEventListener("change", toggleByType);
    toggleByType(); // initial
  });
</script>
{% endblock %}
