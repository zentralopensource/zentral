{% extends 'base.html' %}

{% block content %}
<ol class="breadcrumb">
  <li class="breadcrumb-item"><a href="/">Home</a></li>
  {% if object == request.user %}
  <li class="breadcrumb-item"><a href="{% url 'accounts:profile' %}">Settings</a></li>
  {% else %}
  <li class="breadcrumb-item"><a href="{% url 'accounts:users' %}">Users</a></li>
  <li class="breadcrumb-item"><a href="{% url 'accounts:user' object.pk %}">{{ object.get_type_display|title }} {{ object }}</a></li>
  {% endif %}
  <li class="breadcrumb-item active">API token</li>
</ol>

<h3>{% if object == request.user %}My{% else %}{{ object.get_type_display|title }} {{ object }}{% endif %} API token</h3>

<div class="clearfix">
  <a href="#" class="secret-toggle bi bi-eye btn btn-link float-start mt-2 mb-4 me-2" data-secret-id="auth-token"
    data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="View Token">
  </a>
  <div class="input-group mt-1 input-group-sm invisible w-50 alert alert-primary mt-1 p-2" style="display: none">
    <input style="font-family:monospace" id="auth-token" class="secret form-control" disabled="true" value="{{ api_key }}" size="{{ api_key|length }}" data-bs-toggle="manual" data-bs-placement="bottom" data-bs-title="Copied!" />
    <span class="copy-secret bi bi-clipboard-plus input-group-text" aria-hidden="true" data-secret-id="auth-token" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="Copy to clipboard" style="cursor:pointer;"></span>
  </div>
</div>

<p><span class="text-danger">This token cannot be retrieved later on.</span> However, you can create a new one at any time.</p>

<p>
    {% if object == request.user %}
        <a href="{% url 'accounts:profile' %}" class="btn btn-outline-secondary">Close</a>
    {% else %}
        <a href="{% url 'accounts:user' object.pk %}" class="btn btn-outline-secondary">Close</a>
    {% endif %}
</p>
{% endblock %}

{% block extrajs %}
<script nonce="{{ request.csp_nonce }}">
  var secretToggles = document.querySelectorAll(".secret-toggle");
  secretToggles.forEach(function(secretToggle) {
    secretToggle.addEventListener("click", function(event) {
      event.preventDefault();
      var $secretSwitch = $(secretToggle);
      var $input_parent = $secretSwitch.next('.input-group');
      $input_parent.toggleClass('invisible').toggle();
      $secretSwitch.toggleClass("bi-eye-slash").toggleClass("bi-eye");
    });
  });

  var copySecretButtons = document.querySelectorAll(".copy-secret");
  copySecretButtons.forEach(function(copySecretButton) {
    copySecretButton.addEventListener("click", function(event) {
      event.preventDefault();
      var $secret = $('#' + copySecretButton.dataset.secretId);
      var clipText = $secret.val();
      navigator.clipboard.writeText(clipText).then(
      () => {
        $(copySecretButton).toggleClass("bi-clipboard-plus").toggleClass("bi-check-lg");
        $secret.tooltip('toggle');
        setTimeout(() => {
          $secret.tooltip('toggle');
          $(copySecretButton).toggleClass("bi-clipboard-plus").toggleClass("bi-check-lg");
        }, 3000);
      });
    });
  });
</script>
{% endblock %}
